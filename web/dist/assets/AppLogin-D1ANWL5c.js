import{j as U,c as m,o as k,d as i,b as N,u as M,k as j,r as w,a as R,l as T,m as z,e as o,w as r,h as t,B as A,N as u,t as y,n as C,p as P,g as V,i as f,q as O,s as x,v as I}from"./index-Bh7ncf5g.js";import{a as q,b as F}from"./index-C99W1-_y.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{A as J}from"./Apps-BMKE-_E8.js";import{C as W}from"./CheckmarkCircle-F5e-Yg_4.js";import{K as G}from"./Key-Cuo-08Zj.js";import{L as H}from"./LockClosed-BWrVuZJw.js";import{L as Q}from"./LogIn-CzypOer1.js";const X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Y=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M244 400L100 256l144-144"},null,-1),Z=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M120 256h292"},null,-1),ee=[Y,Z],oe=U({name:"ArrowBack",render:function(h,g){return k(),m("svg",X,ee)}}),te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},re=N('<path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352" fill="currentColor"></path><path d="M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 176v224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M184 176l8 224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M328 176l-8 224"></path>',6),se=[re],ae=U({name:"TrashOutline",render:function(h,g){return k(),m("svg",te,se)}}),ne={class:"app-login-container"},le={class:"login-content"},ie={class:"login-header"},pe={key:0,class:"selected-app-info"},de={class:"app-card"},ce={class:"app-header"},ue={class:"app-icon"},he={class:"app-details"},fe={class:"app-status"},ge={class:"card-header"},ve={class:"form-actions"},me={__name:"AppLogin",setup(S){const h=V(),g=M(),n=j(),b=w(),_=w(!1),s=w(null),a=R({appUuid:"",appSecret:""}),E=()=>{var d;const p=["#667eea","#f56565","#48bb78","#ed8936","#9f7aea","#38b2ac","#ed64a6"],e=(d=s.value)!=null&&d.id?s.value.id.toString().charCodeAt(0)%p.length:0;return p[e]},$={appUuid:[{required:!0,validator:(p,e)=>e==null||e===""?new Error("请输入应用标识符"):typeof e=="string"?e.trim()!==""?!0:new Error("请输入应用标识符"):!0,trigger:"blur"}],appSecret:[{required:!0,message:"请输入应用密钥",trigger:"blur"}]},L=async()=>{var p,e,d;try{await((p=b.value)==null?void 0:p.validate()),_.value=!0;try{const l={appUuid:a.appUuid.trim(),appSecret:a.appSecret.trim()};console.log("发送应用登录请求:",l);const c=await q.appLogin(l);console.log("应用登录响应:",c),g.setAppAuth(c.app,c.token),n.showSuccess("应用登录成功"),h.push("/dashboard")}catch(l){if(console.error("应用登录API错误:",l),l.response){const c=l.response.status,v=((e=l.response.data)==null?void 0:e.message)||l.message;console.error(`API错误状态: ${c}, 消息: ${v}`),n.showError(`登录失败: ${v}`)}else l.request?n.showError("网络错误，请检查连接"):n.showError("登录失败，请重试");if(l.code==="NETWORK_ERROR"||(d=l.message)!=null&&d.includes("Network Error"))if(console.warn("应用登录API不可用，使用模拟验证"),a.appId&&a.appSecret.length>=8){const c=s.value||{id:a.appId,name:"应用",code:"app"},v=`app-token-${Date.now()}`;g.setAppAuth(c,v),n.showSuccess("应用登录成功（模拟模式）"),h.push("/dashboard")}else n.showError("应用ID或密钥格式不正确")}}catch(l){console.error("表单验证错误:",l),n.showError(l.message||"登录失败")}finally{_.value=!1}},B=()=>{h.push("/app-selection")},D=async()=>{if(!s.value){n.showError("请先选择应用");return}try{console.log("Deleting application with ID:",s.value.id,"Type:",typeof s.value.id),confirm(`确定要删除应用 "${s.value.name}" 吗？此操作不可恢复！`)&&(await F.deleteApplication(s.value.id),n.showSuccess("应用删除成功"),s.value=null,a.appId="",a.appSecret="",h.push("/app-selection"))}catch(p){n.showError("删除应用失败"),console.error(p)}};return T(()=>{console.log("AppLogin 初始化 - appStore.currentApp:",n.currentApp),console.log("AppLogin 初始化 - localStorage.currentApp:",localStorage.getItem("currentApp"));const p=localStorage.getItem("currentApp");if(p)try{const e=JSON.parse(p);s.value=e,console.log("从 localStorage 加载应用信息:",e)}catch(e){console.error("解析 localStorage 应用信息失败:",e)}if(n.currentApp&&(s.value=n.currentApp,console.log("从 appStore 加载应用信息:",n.currentApp)),s.value){const e=s.value.uuid||s.value.UUID||s.value.id||"";a.appUuid=typeof e=="number"?e.toString():e,console.log("设置应用UUID:",a.appUuid,"类型:",typeof a.appUuid)}}),(p,e)=>(k(),m("div",ne,[e[8]||(e[8]=N('<div class="background-animation" data-v-a7f04b3f></div><div class="floating-shapes" data-v-a7f04b3f><div class="shape shape-1" data-v-a7f04b3f></div><div class="shape shape-2" data-v-a7f04b3f></div><div class="shape shape-3" data-v-a7f04b3f></div></div>',2)),i("div",le,[i("div",ie,[o(t(A),{text:"",onClick:B,class:"back-button"},{icon:r(()=>[o(t(u),{size:"20"},{default:r(()=>[o(t(oe))]),_:1})]),default:r(()=>[e[2]||(e[2]=f(" 返回应用选择 ",-1))]),_:1})]),s.value?(k(),m("div",pe,[i("div",de,[i("div",ce,[i("div",ue,[o(t(u),{size:"48",color:E()},{default:r(()=>[o(t(J))]),_:1},8,["color"])]),i("div",he,[i("h2",null,y(s.value.name),1),i("p",null,y(s.value.code),1)])]),i("div",fe,[o(t(C),{type:"info",size:"large",bordered:!1},{icon:r(()=>[o(t(u),null,{default:r(()=>[o(t(W))]),_:1})]),default:r(()=>[e[3]||(e[3]=f(" 已选择应用 ",-1))]),_:1})])])])):z("",!0),o(t(P),{class:"login-card"},{header:r(()=>[i("div",ge,[e[5]||(e[5]=i("h2",null,"应用登录",-1)),o(t(C),{type:"success",size:"small",round:""},{default:r(()=>[...e[4]||(e[4]=[f("安全验证",-1)])]),_:1})])]),default:r(()=>[o(t(O),{ref_key:"formRef",ref:b,model:a,rules:$,size:"large"},{default:r(()=>[o(t(x),{path:"appUuid"},{default:r(()=>[o(t(I),{value:a.appUuid,"onUpdate:value":e[0]||(e[0]=d=>a.appUuid=d),placeholder:"请输入应用标识符",clearable:""},{prefix:r(()=>[o(t(u),{color:"#666"},{default:r(()=>[o(t(G))]),_:1})]),_:1},8,["value"])]),_:1}),o(t(x),{path:"appSecret"},{default:r(()=>[o(t(I),{value:a.appSecret,"onUpdate:value":e[1]||(e[1]=d=>a.appSecret=d),type:"password",placeholder:"请输入应用密钥","show-password-on":"click",clearable:""},{prefix:r(()=>[o(t(u),{color:"#666"},{default:r(()=>[o(t(H))]),_:1})]),_:1},8,["value"])]),_:1}),i("div",ve,[o(t(A),{type:"primary",size:"large",loading:_.value,onClick:L,class:"login-btn"},{icon:r(()=>[o(t(u),null,{default:r(()=>[o(t(Q))]),_:1})]),default:r(()=>[e[6]||(e[6]=f(" 登录应用 ",-1))]),_:1},8,["loading"]),o(t(A),{type:"error",size:"large",onClick:D,disabled:!s.value,class:"delete-btn"},{icon:r(()=>[o(t(u),null,{default:r(()=>[o(t(ae))]),_:1})]),default:r(()=>[e[7]||(e[7]=f(" 删除应用 ",-1))]),_:1},8,["disabled"])])]),_:1},8,["model"])]),_:1})])]))}},xe=K(me,[["__scopeId","data-v-a7f04b3f"]]);export{xe as default};
