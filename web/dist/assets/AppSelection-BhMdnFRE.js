import{j as $,c as u,o as p,d as o,x as ne,k as le,u as ae,r as h,y as re,a as ie,l as de,g as ce,e as s,w as n,h as t,N as i,z as ue,m as A,p as z,B as m,F as pe,A as me,C as T,i as v,t as g,D as ve,n as V,E as fe,q as _e,s as M,v as k,G as O}from"./index-Bh7ncf5g.js";import{b as H}from"./index-C99W1-_y.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as ge}from"./ShieldCheckmark-DJZpUdrC.js";import{P as ye,L as we}from"./PersonCircle-BUYz5U4G.js";import{C as K}from"./CheckmarkCircle-F5e-Yg_4.js";import{A as P}from"./Add-DH5gGSs4.js";import{A as R}from"./Apps-BMKE-_E8.js";import{L as ke}from"./LogIn-CzypOer1.js";const Ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},be=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M268 112l144 144l-144 144"},null,-1),xe=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M392 256H100"},null,-1),Ae=[be,xe],ze=$({name:"ArrowForward",render:function(f,d){return p(),u("svg",Ce,Ae)}}),$e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Se=o("path",{d:"M480 128a64 64 0 0 0-64-64h-16V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 368 48v16H144V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 112 48v16H96a64 64 0 0 0-64 64v12a4 4 0 0 0 4 4h440a4 4 0 0 0 4-4z",fill:"currentColor"},null,-1),Ie=o("path",{d:"M32 416a64 64 0 0 0 64 64h320a64 64 0 0 0 64-64V179a3 3 0 0 0-3-3H35a3 3 0 0 0-3 3zm344-208a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24z",fill:"currentColor"},null,-1),Ne=[Se,Ie],Me=$({name:"Calendar",render:function(f,d){return p(),u("svg",$e,Ne)}}),Le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Be=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1),De=[Be],Ue=$({name:"ChevronDown",render:function(f,d){return p(),u("svg",Le,De)}}),je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Fe=o("rect",{x:"128",y:"128",width:"336",height:"336",rx:"57",ry:"57",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),Te=o("path",{d:"M383.5 128l.5-24a56.16 56.16 0 0 0-56-56H112a64.19 64.19 0 0 0-64 64v216a56.16 56.16 0 0 0 56 56h24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Ve=[Fe,Te],q=$({name:"CopyOutline",render:function(f,d){return p(),u("svg",je,Ve)}}),Oe={class:"app-selection-container"},He={class:"app-selection-header"},Ke={class:"header-content"},Pe={class:"logo-section"},Re={class:"logo"},qe={class:"user-section"},Ee={class:"app-selection-content"},Ge={key:0,class:"current-app-section"},Je={class:"current-app-header"},Qe={class:"app-icon-large"},We={class:"current-app-info"},Xe={class:"app-name"},Ye={class:"app-code"},Ze={key:0,class:"app-description"},et={class:"current-app-actions"},tt={class:"app-list-section"},st={class:"section-header"},ot={key:0,class:"app-grid"},nt=["onClick"],lt={class:"app-card-content"},at={class:"app-card-header"},rt={class:"app-icon"},it={class:"app-info"},dt={class:"app-name"},ct={class:"app-code"},ut={key:0,class:"selected-badge"},pt={key:0,class:"app-description"},mt={class:"app-meta"},vt={class:"app-actions"},ft={key:1,class:"empty-state"},_t={class:"empty-content"},ht={class:"empty-icon"},gt={class:"flex justify-end gap-2"},yt={class:"success-content"},wt={class:"success-icon"},kt={class:"credentials-container"},Ct={class:"credential-item"},bt={class:"value-container"},xt={class:"credential-item"},At={class:"value-container"},zt={class:"success-footer"},$t={__name:"AppSelection",setup(C){const f=ce(),d=ne(),S=le(),c=ae(),I=h([]),L=h(!1),N=h(!1),y=h(!1),b=h(!1),w=h({}),B=re(()=>c.isSystemLoggedIn),E=[{label:"退出系统",key:"logout",icon:()=>O(i,null,{default:()=>O(we)})}],G=l=>{l==="logout"&&te()},J=l=>{const e=["#667eea","#f56565","#48bb78","#ed8936","#9f7aea","#38b2ac","#ed64a6"],a=l.id?l.id.toString().charCodeAt(0)%e.length:0;return e[a]},r=ie({code:"",name:"",description:""}),D=h(),Q={code:[{required:!0,message:"请输入应用代码",trigger:"blur"},{pattern:/^[a-z][a-z0-9_-]*$/,message:"应用代码只能包含小写字母、数字、下划线和连字符，且必须以字母开头",trigger:"blur"}],name:[{required:!0,message:"请输入应用名称",trigger:"blur"}]},W=()=>{r.code&&!r.name&&(r.name=r.code.replace(/[-_]/g," ").split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "))},X=l=>l?new Date(l).toLocaleDateString("zh-CN"):"",U=async()=>{try{L.value=!0;const l=await H.getApplications();I.value=l.apps||l.items||l}catch(l){d.error("获取应用列表失败"),console.error(l)}finally{L.value=!1}},Y=l=>{S.setCurrentApp(l),d.success(`已选择应用: ${l.name}`)},Z=l=>{console.log("选择登录应用:",l),S.setCurrentApp(l),localStorage.setItem("currentApp",JSON.stringify(l)),f.push("/app-login")},ee=()=>{f.push("/dashboard")},te=()=>{c.logout(),S.clearCurrentApp(),f.push("/system-login")},se=async()=>{var l,e,a,x;try{await((l=D.value)==null?void 0:l.validate()),N.value=!0;const _=await H.createApplication(r),oe={id:_.appId||((e=_.app)==null?void 0:e.id)||"",uuid:_.appUuid||((a=_.app)==null?void 0:a.uuid)||"",secretKey:_.secretKey||"",code:r.code,name:r.name,description:r.description||""};w.value=oe,y.value=!1,b.value=!0,Object.assign(r,{code:"",name:"",description:""}),await U()}catch(_){((x=_.response)==null?void 0:x.status)===409?d.error("应用代码已存在"):d.error("创建应用失败"),console.error(_)}finally{N.value=!1}},j=l=>{if(!l){d.warning("复制内容为空");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(l).then(()=>{d.success("已复制到剪贴板")}).catch(e=>{console.error("Clipboard API error:",e),F(l)}):F(l)},F=l=>{try{const e=document.createElement("textarea");e.value=l,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",document.body.appendChild(e),e.select(),e.setSelectionRange(0,99999);const a=document.execCommand("copy");document.body.removeChild(e),a?d.success("已复制到剪贴板"):d.error("复制失败，请手动复制")}catch(e){console.error("Fallback copy error:",e),d.error("复制失败，请手动复制")}};return de(()=>{if(!c.isSystemLoggedIn){f.push("/system-login");return}U()}),(l,e)=>(p(),u("div",Oe,[e[30]||(e[30]=o("div",{class:"background-pattern"},null,-1)),o("div",He,[o("div",Ke,[o("div",Pe,[o("div",Re,[s(t(i),{size:"40",color:"#667eea"},{default:n(()=>[s(t(ge))]),_:1})]),e[11]||(e[11]=o("div",{class:"title-section"},[o("h1",null,"应用管理中心"),o("p",null,"管理和配置您的所有应用")],-1))]),o("div",qe,[s(t(ue),{trigger:"hover",options:E,onSelect:G},{default:n(()=>[s(t(m),{text:""},{icon:n(()=>[s(t(i),{size:"20"},{default:n(()=>[s(t(ye))]),_:1})]),suffix:n(()=>[s(t(i),{size:"14"},{default:n(()=>[s(t(Ue))]),_:1})]),default:n(()=>[e[12]||(e[12]=v(" 系统管理员 ",-1))]),_:1})]),_:1})])])]),o("div",Ee,[t(c).currentApp&&t(c).isAppLoggedIn?(p(),u("div",Ge,[s(t(z),{class:"current-app-card",size:"large"},{default:n(()=>[o("div",Je,[o("div",Qe,[s(t(i),{size:"48",color:"#52c41a"},{default:n(()=>[s(t(K))]),_:1})]),o("div",We,[e[13]||(e[13]=o("h2",null,"当前登录应用",-1)),o("div",Xe,g(t(c).currentApp.name),1),o("div",Ye,g(t(c).currentApp.code),1),t(c).currentApp.description?(p(),u("div",Ze,g(t(c).currentApp.description),1)):A("",!0)])]),o("div",et,[s(t(m),{type:"primary",size:"large",onClick:ee},{icon:n(()=>[s(t(i),null,{default:n(()=>[s(t(ze))]),_:1})]),default:n(()=>[e[14]||(e[14]=v(" 进入管理界面 ",-1))]),_:1})])]),_:1})])):A("",!0),o("div",tt,[o("div",st,[e[16]||(e[16]=o("div",{class:"section-title"},[o("h2",null,"我的应用"),o("p",null,"选择或创建新的应用")],-1)),s(t(m),{type:"primary",size:"large",onClick:e[0]||(e[0]=a=>y.value=!0),disabled:!B.value,class:"create-btn"},{icon:n(()=>[s(t(i),null,{default:n(()=>[s(t(P))]),_:1})]),default:n(()=>[e[15]||(e[15]=v(" 创建新应用 ",-1))]),_:1},8,["disabled"])]),I.value.length>0?(p(),u("div",ot,[(p(!0),u(pe,null,me(I.value,a=>(p(),u("div",{key:a.id,class:ve(["app-card",{selected:t(c).currentApp&&a.id===t(c).currentApp.id}]),onClick:x=>Y(a)},[e[19]||(e[19]=o("div",{class:"app-card-background"},null,-1)),o("div",lt,[o("div",at,[o("div",rt,[s(t(i),{size:"32",color:J(a)},{default:n(()=>[s(t(R))]),_:1},8,["color"])]),o("div",it,[o("div",dt,g(a.name),1),o("div",ct,g(a.code),1)]),t(c).currentApp&&a.id===t(c).currentApp.id?(p(),u("div",ut,[s(t(V),{type:"success",size:"small"},{default:n(()=>[...e[17]||(e[17]=[v("当前应用",-1)])]),_:1})])):A("",!0)]),a.description?(p(),u("div",pt,g(a.description),1)):A("",!0),o("div",mt,[s(t(V),{size:"small",type:"info",bordered:!1},{icon:n(()=>[s(t(i),{size:"12"},{default:n(()=>[s(t(Me))]),_:1})]),default:n(()=>[v(" "+g(X(a.createdAt)),1)]),_:2},1024)]),o("div",vt,[s(t(m),{size:"small",type:"primary",onClick:fe(x=>Z(a),["stop"])},{icon:n(()=>[s(t(i),null,{default:n(()=>[s(t(ke))]),_:1})]),default:n(()=>[e[18]||(e[18]=v(" 登录应用 ",-1))]),_:1},8,["onClick"])])])],10,nt))),128))])):(p(),u("div",ft,[o("div",_t,[o("div",ht,[s(t(i),{size:"80",color:"#d9d9d9"},{default:n(()=>[s(t(R))]),_:1})]),e[21]||(e[21]=o("h3",null,"暂无应用",-1)),e[22]||(e[22]=o("p",null,"创建您的第一个应用开始管理权限",-1)),s(t(m),{type:"primary",size:"large",onClick:e[1]||(e[1]=a=>y.value=!0),disabled:!B.value},{icon:n(()=>[s(t(i),null,{default:n(()=>[s(t(P))]),_:1})]),default:n(()=>[e[20]||(e[20]=v(" 创建第一个应用 ",-1))]),_:1},8,["disabled"])])]))])]),s(t(T),{show:y.value,"onUpdate:show":e[6]||(e[6]=a=>y.value=a)},{default:n(()=>[s(t(z),{style:{width:"500px"},title:"创建新应用",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:n(()=>[o("div",gt,[s(t(m),{onClick:e[5]||(e[5]=a=>y.value=!1)},{default:n(()=>[...e[23]||(e[23]=[v("取消",-1)])]),_:1}),s(t(m),{type:"primary",loading:N.value,onClick:se},{default:n(()=>[...e[24]||(e[24]=[v(" 创建 ",-1)])]),_:1},8,["loading"])])]),default:n(()=>[s(t(_e),{ref_key:"formRef",ref:D,model:r,rules:Q},{default:n(()=>[s(t(M),{path:"code",label:"应用代码"},{default:n(()=>[s(t(k),{value:r.code,"onUpdate:value":e[2]||(e[2]=a=>r.code=a),placeholder:"请输入应用代码，如: myapp",onBlur:W},null,8,["value"])]),_:1}),s(t(M),{path:"name",label:"应用名称"},{default:n(()=>[s(t(k),{value:r.name,"onUpdate:value":e[3]||(e[3]=a=>r.name=a),placeholder:"请输入应用名称"},null,8,["value"])]),_:1}),s(t(M),{path:"description",label:"应用描述"},{default:n(()=>[s(t(k),{value:r.description,"onUpdate:value":e[4]||(e[4]=a=>r.description=a),type:"textarea",placeholder:"请输入应用描述",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),s(t(T),{show:b.value,"onUpdate:show":e[10]||(e[10]=a=>b.value=a),"mask-closable":!1,preset:"dialog",title:"应用创建成功"},{footer:n(()=>[o("div",zt,[s(t(m),{type:"primary",size:"large",onClick:e[9]||(e[9]=a=>b.value=!1),block:""},{default:n(()=>[...e[29]||(e[29]=[v(" 我已保存，继续管理 ",-1)])]),_:1})])]),default:n(()=>[o("div",yt,[o("div",wt,[s(t(i),{size:"64",color:"#52c41a"},{default:n(()=>[s(t(K))]),_:1})]),e[27]||(e[27]=o("h3",null,"应用创建成功！",-1)),e[28]||(e[28]=o("p",{class:"success-message"},"请保存以下信息，应用密钥仅在创建时显示一次！",-1)),o("div",kt,[s(t(z),{class:"credential-card",title:"应用标识",size:"small"},{default:n(()=>[o("div",Ct,[e[25]||(e[25]=o("span",{class:"label"},"应用UUID:",-1)),o("div",bt,[s(t(k),{value:w.value.uuid,readonly:"",class:"credential-input"},null,8,["value"]),s(t(m),{circle:"",type:"primary",size:"small",onClick:e[7]||(e[7]=a=>j(w.value.uuid)),class:"copy-btn"},{icon:n(()=>[s(t(i),null,{default:n(()=>[s(t(q))]),_:1})]),_:1})])])]),_:1}),s(t(z),{class:"credential-card",title:"安全凭证",size:"small"},{default:n(()=>[o("div",xt,[e[26]||(e[26]=o("span",{class:"label"},"应用密钥:",-1)),o("div",At,[s(t(k),{value:w.value.secretKey,readonly:"",type:"password","show-password-on":"click",class:"credential-input"},null,8,["value"]),s(t(m),{circle:"",type:"primary",size:"small",onClick:e[8]||(e[8]=a=>j(w.value.secretKey)),class:"copy-btn"},{icon:n(()=>[s(t(i),null,{default:n(()=>[s(t(q))]),_:1})]),_:1})])])]),_:1})])])]),_:1},8,["show"])]))}},Ft=he($t,[["__scopeId","data-v-060afca0"]]);export{Ft as default};
