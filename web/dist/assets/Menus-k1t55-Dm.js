import{m as g}from"./index-C99W1-_y.js";import{k as fe,r as u,a as ve,y as O,l as he,c as W,e as t,w as r,h as s,p as ye,C as me,o as L,m as ge,J as x,d as z,t as Ie,B as c,i as h,N as I,R as ke,v as S,q as we,s as y,K as be,S as Ce,T as xe,U as Se,G as i,n as Me}from"./index-Bh7ncf5g.js";import{T as j,C as G}from"./Trash-AESF4UkK.js";import{A as H}from"./Add-DH5gGSs4.js";const Ne={style:{display:"flex","justify-content":"space-between","align-items":"center"}},De={key:0,style:{"margin-bottom":"16px",padding:"12px","background-color":"#f5f5f5","border-radius":"6px"}},ze={__name:"Menus",setup(Ke){const p=fe(),M=a=>Array.isArray(a)?a.map(e=>({ID:e.ID||e.id,name:e.name||e.Name,type:e.type||e.Type,parentId:e.parentId||e.ParentID,path:e.path||e.Path,component:e.component||e.Component,sort:e.sort||e.Sort,hidden:e.hidden||e.Hidden,isSystem:e.isSystem||e.IsSystem,children:e.children&&e.children.length>0?M(e.children):[]})):[],k=u([]),B=u(!1),N=u(!1),f=u(!1),v=u(!1),C=u(null),w=u(""),J=()=>{m()},Q=()=>{w.value="",m()},o=u([]),D=u([]),K=u([]),T=u([]),P=u([]),q=u(),n=ve({name:"",path:"",component:"",type:1,parentId:null,sort:0,hidden:!1}),X={name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],path:[{required:!0,message:"请输入菜单路径",trigger:"blur"}]},Y=[{label:"目录",value:0},{label:"菜单",value:1},{label:"按钮",value:2}],Z=a=>({0:"目录",1:"菜单",2:"按钮"})[a]||"未知",_=a=>({0:"success",1:"info",2:"warning"})[a]||"default",ee=O(()=>{const a=(e,l=0)=>e.map(d=>({label:d.name,value:d.ID,children:d.children&&d.children.length>0?a(d.children,l+1):void 0}));return[{label:"根菜单",value:0},...a(k.value)]}),ae=({option:a})=>i("div",{style:"display: flex; align-items: center; gap: 8px;"},[i("span",a.name),i(Me,{type:_(a.type),size:"small"},()=>Z(a.type))]),le=({option:a})=>i(x,{size:"small"},{default:()=>[a.type===0||a.type===1?i(c,{size:"small",type:"primary",quaternary:!0,onClick:e=>{e.stopPropagation(),te(a)}},{default:()=>"添加子菜单",icon:()=>i(I,null,{default:()=>i(H)})}):null,i(c,{size:"small",type:"warning",quaternary:!0,onClick:e=>{e.stopPropagation(),R(a)}},{default:()=>"编辑",icon:()=>i(I,null,{default:()=>i(G)})}),i(c,{size:"small",type:"error",quaternary:!0,onClick:e=>{e.stopPropagation(),confirm("确定要删除该菜单吗？")&&re(a)}},{default:()=>"删除",icon:()=>i(I,null,{default:()=>i(j)})})]}),ne=O({get:()=>f.value&&!v.value,set:a=>{a?(v.value=!1,f.value=!0):f.value=!1}}),U=a=>{let e=[];return a.forEach(l=>{e.push(l.ID),l.children&&l.children.length>0&&(e=e.concat(U(l.children)))}),e},m=async()=>{B.value=!0;try{let a;if(w.value)a=await g.getMenus({name:w.value}),k.value=M(a||[]);else{a=await g.getMenuTree();const e=M(a||[]);k.value=e,K.value=U(e),P.value=U(e)}}catch{p.showError("加载菜单列表失败")}finally{B.value=!1}},R=a=>{v.value=!0,C.value=a.ID,n.name=a.name||"",n.path=a.path||"",n.component=a.component||"",n.type=a.type||1,n.parentId=a.parentId||0,n.sort=a.sort||0,n.hidden=a.hidden||!1,f.value=!0},te=a=>{v.value=!1,C.value=null,V(),n.parentId=a.ID,f.value=!0},se=async()=>{var a;try{await((a=q.value)==null?void 0:a.validate()),N.value=!0;const e={name:n.name,path:n.path,component:n.component,type:n.type,parentId:n.parentId||0,sort:n.sort,hidden:n.hidden};v.value?(await g.updateMenu(C.value,e),p.showSuccess("菜单更新成功")):(await g.createMenu(e),p.showSuccess("菜单创建成功")),f.value=!1,m()}catch(e){p.showError(e.message||"保存失败")}finally{N.value=!1}},re=async a=>{try{const e=a.ID;await g.deleteMenu(e),p.showSuccess("菜单删除成功"),m()}catch{p.showError("删除失败")}},V=()=>{n.name="",n.path="",n.component="",n.type=1,n.parentId=null,n.sort=0,n.hidden=!1,v.value=!1,C.value=null},E=a=>{let e=[];return a.children&&a.children.length>0&&a.children.forEach(l=>{e.push(l.ID),e=e.concat(E(l))}),e},oe=(a,e,l)=>{if(l.action==="check"){const d=e.find(b=>b.ID===l.node.ID);if(d){const b=E(d),A=[...new Set([...a,...b])];o.value=A}else o.value=a}else if(l.action==="uncheck"){const d=E(l.node),b=a.filter(A=>!d.includes(A));o.value=b}else o.value=a},de=a=>{D.value=a},ue=(a,e,l)=>{K.value=a},ie=(a,e,l)=>{T.value=a},$=()=>{o.value=[],D.value=[],T.value=[]},pe=async()=>{if(o.value.length===0){p.showWarning("请先选择要删除的菜单");return}if(confirm(`确定要删除选中的 ${o.value.length} 个菜单吗？此操作不可撤销！`))try{const a=o.value.map(e=>g.deleteMenu(e));await Promise.all(a),p.showSuccess(`成功删除 ${o.value.length} 个菜单`),$(),m()}catch{p.showError("批量删除失败")}},ce=()=>{if(o.value.length===0){p.showWarning("请先选择要编辑的菜单");return}if(o.value.length>1){p.showWarning("批量编辑功能暂时只支持单个菜单的编辑，请选择一个菜单");return}const a=F(k.value,o.value[0]);a&&R(a)},F=(a,e)=>{for(const l of a){if(l.ID===e)return l;if(l.children&&l.children.length>0){const d=F(l.children,e);if(d)return d}}return null};return he(()=>{m()}),(a,e)=>(L(),W("div",null,[t(s(ye),null,{header:r(()=>[z("div",Ne,[t(s(x),{align:"center"},{default:r(()=>[e[12]||(e[12]=z("span",null,"菜单列表",-1)),t(s(S),{value:w.value,"onUpdate:value":[e[0]||(e[0]=l=>w.value=l),J],placeholder:"搜索菜单名称",clearable:"",style:{width:"200px"}},null,8,["value"]),t(s(c),{onClick:Q},{default:r(()=>[...e[11]||(e[11]=[h("重置",-1)])]),_:1})]),_:1}),t(s(c),{type:"primary",onClick:e[1]||(e[1]=l=>ne.value=!0)},{icon:r(()=>[t(s(I),null,{default:r(()=>[t(s(H))]),_:1})]),default:r(()=>[e[13]||(e[13]=h(" 添加菜单 ",-1))]),_:1})])]),default:r(()=>[o.value.length>0?(L(),W("div",De,[t(s(x),{align:"center"},{default:r(()=>[z("span",null,"已选择 "+Ie(o.value.length)+" 项",1),t(s(c),{size:"small",type:"error",onClick:pe},{icon:r(()=>[t(s(I),null,{default:r(()=>[t(s(j))]),_:1})]),default:r(()=>[e[14]||(e[14]=h(" 批量删除 ",-1))]),_:1}),t(s(c),{size:"small",type:"warning",onClick:ce},{icon:r(()=>[t(s(I),null,{default:r(()=>[t(s(G))]),_:1})]),default:r(()=>[e[15]||(e[15]=h(" 批量编辑 ",-1))]),_:1}),t(s(c),{size:"small",onClick:$},{default:r(()=>[...e[16]||(e[16]=[h(" 清除选择 ",-1)])]),_:1})]),_:1})])):ge("",!0),t(s(ke),{data:k.value,"render-label":ae,"render-suffix":le,"expand-on-click":!0,checkable:!0,cascade:!0,"check-strategy":"all","checked-keys":o.value,"indeterminate-keys":D.value,"expanded-keys":K.value,"selected-keys":T.value,"default-expanded-keys":P.value,"show-line":!0,indent:20,"block-line":"","key-field":"ID","label-field":"name","children-field":"children","onUpdate:checkedKeys":oe,"onUpdate:indeterminateKeys":de,"onUpdate:expandedKeys":ue,"onUpdate:selectedKeys":ie},null,8,["data","checked-keys","indeterminate-keys","expanded-keys","selected-keys","default-expanded-keys"])]),_:1}),t(s(me),{show:f.value,"onUpdate:show":e[10]||(e[10]=l=>f.value=l),title:v.value?"编辑菜单":"添加菜单",preset:"dialog","show-icon":!1,onAfterLeave:V},{action:r(()=>[t(s(x),null,{default:r(()=>[t(s(c),{onClick:e[9]||(e[9]=l=>f.value=!1)},{default:r(()=>[...e[17]||(e[17]=[h("取消",-1)])]),_:1}),t(s(c),{type:"primary",loading:N.value,onClick:se},{default:r(()=>[...e[18]||(e[18]=[h(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:r(()=>[t(s(we),{ref_key:"formRef",ref:q,model:n,rules:X,"label-placement":"left","label-width":"80px"},{default:r(()=>[t(s(y),{label:"名称",path:"name"},{default:r(()=>[t(s(S),{value:n.name,"onUpdate:value":e[2]||(e[2]=l=>n.name=l),placeholder:"请输入菜单名称"},null,8,["value"])]),_:1}),t(s(y),{label:"路径",path:"path"},{default:r(()=>[t(s(S),{value:n.path,"onUpdate:value":e[3]||(e[3]=l=>n.path=l),placeholder:"请输入菜单路径"},null,8,["value"])]),_:1}),t(s(y),{label:"组件",path:"component"},{default:r(()=>[t(s(S),{value:n.component,"onUpdate:value":e[4]||(e[4]=l=>n.component=l),placeholder:"请输入组件路径"},null,8,["value"])]),_:1}),t(s(y),{label:"类型",path:"type"},{default:r(()=>[t(s(be),{value:n.type,"onUpdate:value":e[5]||(e[5]=l=>n.type=l),placeholder:"请选择菜单类型",options:Y},null,8,["value"])]),_:1}),t(s(y),{label:"父菜单",path:"parentId"},{default:r(()=>[t(s(Ce),{value:n.parentId,"onUpdate:value":e[6]||(e[6]=l=>n.parentId=l),placeholder:"请选择父菜单",options:ee.value,clearable:""},null,8,["value","options"])]),_:1}),t(s(y),{label:"排序",path:"sort"},{default:r(()=>[t(s(xe),{value:n.sort,"onUpdate:value":e[7]||(e[7]=l=>n.sort=l),min:0,placeholder:"请输入排序值"},null,8,["value"])]),_:1}),t(s(y),{label:"是否隐藏",path:"hidden"},{default:r(()=>[t(s(Se),{value:n.hidden,"onUpdate:value":e[8]||(e[8]=l=>n.hidden=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}};export{ze as default};
