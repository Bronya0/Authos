import{d as g}from"./index-C99W1-_y.js";import{k as j,r as u,a as x,y as F,l as J,c as K,e as l,w as o,f as d,o as Q,G as p,d as I,h as i,J as _,B as y,i as b,N as E}from"./index-Bh7ncf5g.js";import{A as W}from"./Add-DH5gGSs4.js";import{C as X,T as Y}from"./Trash-AESF4UkK.js";const Z={style:{display:"flex","justify-content":"space-between","align-items":"center"}},oe={__name:"Permissions",setup(ee){const m=j(),v=u([]),w=u(!1),A=u(!1),r=u(!1),f=u(!1),P=u(null),s=x({name:"",path:"",method:null}),T=()=>{h()},D=()=>{s.name="",s.path="",s.method=null,h()},C=u(),t=x({key:"",name:"",path:"",method:"",description:""}),q={key:[{required:!0,message:"请输入权限标识",trigger:"blur"}],name:[{required:!0,message:"请输入权限名称",trigger:"blur"}],path:[{required:!0,message:"请输入API路径",trigger:"blur"}],method:[{required:!0,message:"请选择HTTP方法",trigger:"change"}]},S=[{label:"全部",value:"*"},{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"}],N=F({get:()=>r.value&&!f.value,set:a=>{a?(f.value=!1,r.value=!0):r.value=!1}}),B=[{title:"ID",key:"id",width:80,render:a=>a.ID||a.id},{title:"标识",key:"key"},{title:"名称",key:"name"},{title:"路径",key:"path"},{title:"方法",key:"method",width:80},{title:"描述",key:"description",render:a=>a.description||"-"},{title:"操作",key:"actions",width:200,render:a=>p(_,null,{default:()=>[p(y,{size:"small",type:"warning",quaternary:!0,onClick:()=>z(a)},{default:()=>"编辑",icon:()=>p(E,null,{default:()=>p(X)})}),p(y,{size:"small",type:"error",quaternary:!0,onClick:()=>{confirm("确定要删除该权限吗？")&&L(a)}},{default:()=>"删除",icon:()=>p(E,null,{default:()=>p(Y)})})]})}],H={pageSize:10},h=async()=>{w.value=!0;try{const a=await g.getApiPermissions(s);a&&Array.isArray(a)?v.value=a:a&&a.items&&Array.isArray(a.items)?v.value=a.items:a&&Array.isArray(a)?v.value=a:v.value=[]}catch(a){console.error("加载权限列表失败:",a),m.showError("加载权限列表失败"),v.value=[]}finally{w.value=!1}},z=a=>{f.value=!0,P.value=a.ID||a.id,t.name=a.name,t.key=a.key,t.path=a.path,t.method=a.method,t.description=a.description||"",r.value=!0},G=async()=>{var a;try{await((a=C.value)==null?void 0:a.validate()),A.value=!0;const e={key:t.key,name:t.name,path:t.path,method:t.method,description:t.description};f.value?(await g.updateApiPermission(P.value,e),m.showSuccess("权限更新成功")):(await g.createApiPermission(e),m.showSuccess("权限创建成功")),r.value=!1,h()}catch(e){m.showError(e.message||"保存失败")}finally{A.value=!1}},L=async a=>{try{const e=a.id||a.ID;await g.deleteApiPermission(e),m.showSuccess("权限删除成功"),h()}catch{m.showError("删除失败")}},M=()=>{t.name="",t.key="",t.path="",t.method="",t.description="",f.value=!1,P.value=null};return J(()=>{h()}),(a,e)=>{const c=d("n-input"),U=d("n-select"),O=d("n-data-table"),R=d("n-card"),k=d("n-form-item"),V=d("n-form"),$=d("n-modal");return Q(),K("div",null,[l(R,null,{header:o(()=>[I("div",Z,[l(i(_),{align:"center"},{default:o(()=>[e[12]||(e[12]=I("span",null,"权限列表",-1)),l(c,{value:s.name,"onUpdate:value":[e[0]||(e[0]=n=>s.name=n),T],placeholder:"搜索权限名称",clearable:"",style:{width:"180px"}},null,8,["value"]),l(c,{value:s.path,"onUpdate:value":[e[1]||(e[1]=n=>s.path=n),T],placeholder:"搜索路径",clearable:"",style:{width:"180px"}},null,8,["value"]),l(U,{value:s.method,"onUpdate:value":[e[2]||(e[2]=n=>s.method=n),T],placeholder:"方法",clearable:"",options:S,style:{width:"120px"}},null,8,["value"]),l(i(y),{onClick:D},{default:o(()=>[...e[11]||(e[11]=[b("重置",-1)])]),_:1})]),_:1}),l(i(y),{type:"primary",onClick:e[3]||(e[3]=n=>N.value=!0)},{icon:o(()=>[l(i(E),null,{default:o(()=>[l(i(W))]),_:1})]),default:o(()=>[e[13]||(e[13]=b(" 添加权限 ",-1))]),_:1})])]),default:o(()=>[l(O,{columns:B,data:v.value||[],loading:w.value,pagination:H,"row-key":n=>n.id||n.ID},null,8,["data","loading","row-key"])]),_:1}),l($,{show:r.value,"onUpdate:show":e[10]||(e[10]=n=>r.value=n),title:f.value?"编辑权限":"添加权限",preset:"dialog","show-icon":!1,onAfterLeave:M},{action:o(()=>[l(i(_),null,{default:o(()=>[l(i(y),{onClick:e[9]||(e[9]=n=>r.value=!1)},{default:o(()=>[...e[14]||(e[14]=[b("取消",-1)])]),_:1}),l(i(y),{type:"primary",loading:A.value,onClick:G},{default:o(()=>[...e[15]||(e[15]=[b(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:o(()=>[l(V,{ref_key:"formRef",ref:C,model:t,rules:q,"label-placement":"left","label-width":"80px"},{default:o(()=>[l(k,{label:"标识",path:"key"},{default:o(()=>[l(c,{value:t.key,"onUpdate:value":e[4]||(e[4]=n=>t.key=n),placeholder:"例如 user:create，用于业务系统校验"},null,8,["value"])]),_:1}),l(k,{label:"名称",path:"name"},{default:o(()=>[l(c,{value:t.name,"onUpdate:value":e[5]||(e[5]=n=>t.name=n),placeholder:"请输入权限名称"},null,8,["value"])]),_:1}),l(k,{label:"路径",path:"path"},{default:o(()=>[l(c,{value:t.path,"onUpdate:value":e[6]||(e[6]=n=>t.path=n),placeholder:"请输入API路径，如/api/v1/users"},null,8,["value"])]),_:1}),l(k,{label:"方法",path:"method"},{default:o(()=>[l(U,{value:t.method,"onUpdate:value":e[7]||(e[7]=n=>t.method=n),placeholder:"请选择HTTP方法",options:S},null,8,["value"])]),_:1}),l(k,{label:"描述",path:"description"},{default:o(()=>[l(c,{value:t.description,"onUpdate:value":e[8]||(e[8]=n=>t.description=n),type:"textarea",placeholder:"请输入权限描述"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}};export{oe as default};
