import{e as h}from"./index-C99W1-_y.js";import{k as J,I as L,r as v,a as x,y as H,l as K,c as O,e as l,w as s,f as m,o as Q,G as c,d as E,h as i,J as b,B as k,i as w,N as I}from"./index-Bh7ncf5g.js";import{f as W}from"./format-CL3lqu5w.js";import{A as X}from"./Add-DH5gGSs4.js";import{C as Y,T as Z}from"./Trash-AESF4UkK.js";const V={style:{display:"flex","justify-content":"space-between","align-items":"center"}},oe={__name:"ConfigDictionaries",setup(ee){const d=J();L(()=>d.currentApp,(e,a)=>{(e==null?void 0:e.id)!==(a==null?void 0:a.id)&&(e?p():f.value=[])});const f=v([]),C=v(!1),A=v(!1),r=v(!1),y=v(!1),g=v(null),_=x({key:""}),N=()=>{p()},B=()=>{_.key="",p()},S=v(),t=x({key:"",value:"",desc:""}),U={key:[{required:!0,message:"请输入字典key",trigger:"blur"}],value:[{required:!0,message:"请输入字典value",trigger:"blur"}]},q=H({get:()=>r.value&&!y.value,set:e=>{e?(y.value=!1,r.value=!0):r.value=!1}}),z=[{title:"ID",key:"id",width:80,render:e=>e.ID||e.id},{title:"key",key:"key",width:220},{title:"value",key:"value",ellipsis:!0},{title:"描述",key:"desc",render:e=>e.desc||"-"},{title:"创建时间",key:"CreatedAt",width:180,render:e=>W(e.CreatedAt)},{title:"操作",key:"actions",width:200,render:e=>c(b,null,{default:()=>[c(k,{size:"small",type:"warning",quaternary:!0,onClick:()=>R(e)},{default:()=>"编辑",icon:()=>c(I,null,{default:()=>c(Y)})}),c(k,{size:"small",type:"error",quaternary:!0,onClick:()=>{confirm("确定要删除该字典吗？")&&P(e)}},{default:()=>"删除",icon:()=>c(I,null,{default:()=>c(Z)})})]})}],M={pageSize:10},p=async()=>{C.value=!0;try{const e=await h.getConfigDictionaries(_);e&&Array.isArray(e)?f.value=e:e&&e.items&&Array.isArray(e.items)?f.value=e.items:e&&Array.isArray(e)?f.value=e:f.value=[]}catch{d.showError("加载配置字典失败"),f.value=[]}finally{C.value=!1}},R=e=>{y.value=!0,g.value=e.ID||e.id,t.key=e.key,t.value=e.value,t.desc=e.desc||"",r.value=!0},T=async()=>{var e,a,o;try{await((e=S.value)==null?void 0:e.validate()),A.value=!0,y.value&&g.value?(await h.updateConfigDictionary(g.value,{key:t.key,value:t.value,desc:t.desc}),d.showSuccess("配置字典更新成功")):(await h.createConfigDictionary({key:t.key,value:t.value,desc:t.desc}),d.showSuccess("配置字典创建成功")),r.value=!1,p()}catch(u){d.showError(((o=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:o.message)||"保存配置字典失败")}finally{A.value=!1}},P=async e=>{var a,o;try{await h.deleteConfigDictionary(e.ID||e.id),d.showSuccess("配置字典删除成功"),p()}catch(u){d.showError(((o=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:o.message)||"删除配置字典失败")}},$=()=>{t.key="",t.value="",t.desc="",y.value=!1,g.value=null};return K(()=>{p()}),(e,a)=>{const o=m("n-input"),u=m("n-data-table"),j=m("n-card"),D=m("n-form-item"),F=m("n-form"),G=m("n-modal");return Q(),O("div",null,[l(j,null,{header:s(()=>[E("div",V,[l(i(b),{align:"center"},{default:s(()=>[a[8]||(a[8]=E("span",null,"配置字典",-1)),l(o,{value:_.key,"onUpdate:value":[a[0]||(a[0]=n=>_.key=n),N],placeholder:"按key搜索",clearable:"",style:{width:"220px"}},null,8,["value"]),l(i(k),{onClick:B},{default:s(()=>[...a[7]||(a[7]=[w("重置",-1)])]),_:1})]),_:1}),l(i(k),{type:"primary",onClick:a[1]||(a[1]=n=>q.value=!0)},{icon:s(()=>[l(i(I),null,{default:s(()=>[l(i(X))]),_:1})]),default:s(()=>[a[9]||(a[9]=w(" 新增字典 ",-1))]),_:1})])]),default:s(()=>[l(u,{columns:z,data:f.value||[],loading:C.value,pagination:M,"row-key":n=>n.id||n.ID},null,8,["data","loading","row-key"])]),_:1}),l(G,{show:r.value,"onUpdate:show":a[6]||(a[6]=n=>r.value=n),title:y.value?"编辑字典":"新增字典",preset:"dialog","show-icon":!1,onAfterLeave:$},{action:s(()=>[l(i(b),null,{default:s(()=>[l(i(k),{onClick:a[5]||(a[5]=n=>r.value=!1)},{default:s(()=>[...a[10]||(a[10]=[w("取消",-1)])]),_:1}),l(i(k),{type:"primary",loading:A.value,onClick:T},{default:s(()=>[...a[11]||(a[11]=[w(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:s(()=>[l(F,{ref_key:"formRef",ref:S,model:t,rules:U,"label-placement":"left","label-width":"80px"},{default:s(()=>[l(D,{label:"key",path:"key"},{default:s(()=>[l(o,{value:t.key,"onUpdate:value":a[2]||(a[2]=n=>t.key=n),placeholder:"请输入字典key"},null,8,["value"])]),_:1}),l(D,{label:"value",path:"value"},{default:s(()=>[l(o,{value:t.value,"onUpdate:value":a[3]||(a[3]=n=>t.value=n),placeholder:"请输入字典value"},null,8,["value"])]),_:1}),l(D,{label:"描述",path:"desc"},{default:s(()=>[l(o,{value:t.desc,"onUpdate:value":a[4]||(a[4]=n=>t.desc=n),type:"textarea",placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}};export{oe as default};
